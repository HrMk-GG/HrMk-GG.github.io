<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moment Swap - ä»Šã‚’äº¤æ›ã™ã‚‹ã‚µã‚¤ãƒˆ</title>
    <style>
        body {
            background: #000; color: #fff; font-family: sans-serif;
            margin: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh;
        }
        #main-container { width: 90%; max-width: 400px; text-align: center; }
        video, canvas, #received-photo {
            width: 100%; border-radius: 20px; border: 4px solid #fff; box-shadow: 0 0 20px rgba(255,255,255,0.2);
            margin-bottom: 20px; background: #222;
        }
        .btn {
            background: #fff; color: #000; border: none; padding: 15px 30px;
            font-size: 1.2rem; font-weight: bold; border-radius: 50px; cursor: pointer;
            transition: 0.3s; width: 100%;
        }
        .btn:active { transform: scale(0.95); opacity: 0.8; }
        #status { margin-top: 15px; font-size: 0.9rem; color: #aaa; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div id="main-container">
    <h1>Moment Swap</h1>
    
    <video id="camera" autoplay playsinline></video>
    
    <canvas id="snapshot" class="hidden"></canvas>
    
    <div id="result-area" class="hidden">
        <p>âœ¨ èª°ã‹ã®ã€Œä»Šã€ãŒå±Šãã¾ã—ãŸï¼</p>
        <img id="received-photo" src="" alt="å±Šã„ãŸå†™çœŸ">
        <button class="btn" onclick="location.reload()">ã‚‚ã†ä¸€åº¦äº¤æ›ã™ã‚‹</button>
    </div>

    <div id="ui-area">
        <button id="capture-btn" class="btn">ğŸ“· ä»Šã‚’æ’®ã£ã¦äº¤æ›ã™ã‚‹</button>
        <p id="status">ã‚«ãƒ¡ãƒ©ã‚’è¨±å¯ã—ã¦æ’®å½±ã—ã¦ã­ï¼</p>
    </div>
</div>

<script>
    const video = document.getElementById('camera');
    const canvas = document.getElementById('snapshot');
    const captureBtn = document.getElementById('capture-btn');
    const resultArea = document.getElementById('result-area');
    const receivedPhoto = document.getElementById('received-photo');
    const uiArea = document.getElementById('ui-area');

    // ã‚«ãƒ¡ãƒ©ã‚’èµ·å‹•
    async function initCamera() {
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ 
                video: { facingMode: "environment" }, // å¤–ã‚«ãƒ¡ãƒ©å„ªå…ˆ
                audio: false 
            });
            video.srcObject = stream;
        } catch (err) {
            document.getElementById('status').innerText = "ã‚«ãƒ¡ãƒ©ã®èµ·å‹•ã«å¤±æ•—ã—ãŸãœâ€¦";
        }
    }

    // æ’®å½±ã¨ã€Œäº¤æ›ã€ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
    captureBtn.onclick = () => {
        // 1. æ’®å½±
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        canvas.getContext('2d').drawImage(video, 0, 0);
        
        // 2. æ¼”å‡ºï¼ˆé€ä¿¡ä¸­â€¦çš„ãªï¼‰
        captureBtn.innerText = "é€ä¿¡ä¸­...";
        captureBtn.disabled = true;

        setTimeout(() => {
            // 3. ã€Œèª°ã‹ã®å†™çœŸã€ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«è¡¨ç¤ºï¼ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ï¼‰
            // å®Ÿéš›ã¯ã“ã“ã§ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ç”»åƒã‚’ã‚‚ã‚‰ã†
            const randomID = Math.floor(Math.random() * 1000);
            receivedPhoto.src = `https://picsum.photos/seed/${randomID}/600/800`;
            
            // 4. è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
            video.classList.add('hidden');
            uiArea.classList.add('hidden');
            resultArea.classList.remove('hidden');
        }, 1500);
    };

    initCamera();
</script>

</body>
</html>
