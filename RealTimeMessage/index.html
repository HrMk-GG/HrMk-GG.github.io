<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liquid Glass - Slim Edition</title>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
    <style>
        body { 
            margin: 0; padding: 0; 
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            font-family: sans-serif; overflow: hidden; height: 100vh; 
        }

        #danmaku-stage { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; }

        .comment {
            position: absolute; white-space: nowrap; font-weight: 800;
            text-shadow: 0 0 8px rgba(255,255,255,0.4);
            animation: flow linear forwards;
            will-change: transform;
        }

        @keyframes flow { from { transform: translateX(100vw); } to { transform: translateX(-100%); } }

        /* --- 横幅をスリムにした操作バー --- */
        .ui-panel {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            z-index: 100;
            /* 横幅を固定してコンパクトに！ */
            width: fit-content;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 30px; padding: 10px 25px;
            display: flex; align-items: center; gap: 15px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        .input-group { display: flex; flex-direction: column; align-items: center; font-size: 9px; color: rgba(255,255,255,0.6); }
        
        input[type="text"] { 
            background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2);
            color: white; padding: 8px 12px; border-radius: 12px; outline: none; font-size: 14px;
        }
        
        #nickname { width: 70px; }
        #message { width: 200px; } /* メッセージ入力欄も少し短くしたぜ */
        
        #send-btn {
            background: rgba(255, 255, 255, 0.9); color: #1e293b; border: none; 
            padding: 8px 20px; border-radius: 12px; cursor: pointer; font-weight: 900; 
            transition: 0.3s;
        }
        #send-btn:hover { background: #fff; transform: translateY(-2px); }

        input[type="color"] { border: none; width: 25px; height: 25px; cursor: pointer; background: none; }
        input[type="range"] { width: 60px; accent-color: #fff; }
    </style>
</head>
<body>

    <div id="danmaku-stage"></div>

    <div class="ui-panel">
        <div class="input-group">
            <span>NAME</span>
            <input type="text" id="nickname" placeholder="Name" maxlength="8">
        </div>
        
        <div class="input-group">
            <span>COLOR</span>
            <input type="color" id="color" value="#ffffff">
        </div>

        <div class="input-group">
            <span>SIZE</span>
            <input type="range" id="size" min="20" max="80" value="40">
        </div>

        <input type="text" id="message" placeholder="Message..." maxlength="50">
        <button id="send-btn">SEND</button>
    </div>

<script>
// Firebaseの設定
const firebaseConfig = {
  apiKey: "AIzaSyCxexufR8PjjXe_AjkObG2bwvAxYgd6P4U",
  authDomain: "realtimemessage-754ef.firebaseapp.com",
  projectId: "realtimemessage-754ef",
  storageBucket: "realtimemessage-754ef.firebasestorage.app",
  messagingSenderId: "727350340778",
  appId: "1:727350340778:web:5b271891c83c7e5400b4d3",
  measurementId: "G-M7G5MQ90CK"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

function launch(text, color, size) {
    const stage = document.getElementById('danmaku-stage');
    const div = document.createElement('div');
    div.className = 'comment';
    div.innerText = text;
    div.style.color = color;
    div.style.fontSize = size + "px";
    div.style.top = (Math.random() * 85 + 5) + "%";
    const speed = Math.random() * 3 + 4;
    div.style.animationDuration = speed + "s";
    stage.appendChild(div);
    setTimeout(() => div.remove(), speed * 1000);
}

document.getElementById('send-btn').onclick = async () => {
    const msg = document.getElementById('message').value.trim();
    if (!msg) return;
    await db.collection("comments").add({
        content: `[${document.getElementById('nickname').value || "Guest"}] ${msg}`,
        color: document.getElementById('color').value,
        size: parseInt(document.getElementById('size').value),
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });
    document.getElementById('message').value = "";
};

document.getElementById('message').addEventListener('keypress', (e) => { if (e.key === 'Enter') document.getElementById('send-btn').click(); });

db.collection("comments").orderBy("createdAt", "desc").limit(1).onSnapshot(snapshot => {
    snapshot.docChanges().forEach(change => {
        if (change.type === "added") {
            const data = change.doc.data();
            if (data.content) launch(data.content, data.color, data.size);
        }
    });
});
</script>
</body>
</html>
